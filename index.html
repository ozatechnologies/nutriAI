<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot UI</title>
    <style>
        /* General Styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f9;
        }

        /* Chatbot Container */
        #chatbot {
            width: 400px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Chat Header */
        #chat-header {
            background-color: #007bff;
            color: #fff;
            padding: 15px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }

        /* Chat Window */
        #chat-window {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            border-bottom: 1px solid #ddd;
            background-color: #f9f9f9;
        }

        /* Message Styling */
        .message {
            margin-bottom: 15px;
            display: flex;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 70%;
            padding: 10px;
            border-radius: 10px;
            word-wrap: break-word;
        }

        .message.user .message-content {
            background-color: #007bff;
            color: #fff;
        }

        .message.bot .message-content {
            background-color: #e9ecef;
            color: #333;
        }

        /* Chat Input Area */
        #chat-input-area {
            display: flex;
            padding: 10px;
            background-color: #fff;
        }

        #chat-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            outline: none;
        }

        #send-button {
            margin-left: 10px;
            padding: 10px 20px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #send-button:hover {
            background-color: #0056b3;
        }

        /* Table Styling (for LaTeX tables) */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 8px;
            text-align: center;
        }
    </style>
</head>
<body>

<div id="chatbot">
    <div id="chat-header">Chatbot</div>
    <div id="chat-window">
        <!-- Chat messages will appear here -->
    </div>
    <div id="chat-input-area">
        <input type="text" id="chat-input" placeholder="Type your message...">
        <button id="send-button" onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
    async function sendMessage() {
        const userInput = document.getElementById('chat-input').value.trim();
        const chatWindow = document.getElementById('chat-window');

        if (!userInput) {
            alert('Please enter a message.');
            return;
        }

        // Add user message to chat window
        addMessage('user', userInput);

        // Clear input field
        document.getElementById('chat-input').value = '';

        // Scroll to bottom of chat window
        chatWindow.scrollTop = chatWindow.scrollHeight;

        // Add "Thinking..." message
        const botThinking = addMessage('bot', 'Thinking...');

        try {
            // Send message to OpenAI API
            const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer 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',
                    'HTTP-Referer': '<YOUR_SITE_URL>', // Optional
                    'X-Title': '<YOUR_SITE_NAME>' // Optional
                },
                body: JSON.stringify({
                    model: "moonshotai/moonlight-16b-a3b-instruct:free",
                    messages: [
                        {
                            "role": "Nutritionist",
                            "content": "Assume the role of a Nutritionist. Develop customized meal plans for clients with specific health goals, such as weight loss, muscle gain, or managing chronic conditions like diabetes or hypertension. Consider factors like caloric needs, macronutrient ratios, micronutrient requirements, and portion sizes. Provide a variety of meal options and recipes to ensure nutritional adequacy and adherence to dietary guidelines."
                        }
                    ]
                })
            });

            const data = await response.json();

            // Clean up the response (remove \boxed{} and other LaTeX formatting)
            let botResponse = data.choices[0].message.content;
            botResponse = botResponse.replace(/\\boxed\{([^}]+)\}/g, '$1'); // Remove \boxed{}
            botResponse = botResponse.replace(/\\[a-zA-Z]+\{([^}]+)\}/g, '$1'); // Remove other LaTeX commands

            // Convert LaTeX table to HTML table (if applicable)
            if (botResponse.includes('\\begin{array}')) {
                botResponse = convertLaTeXTableToHTML(botResponse);
            }

            // Replace "Thinking..." with bot's response
            botThinking.innerHTML = `<div class="message-content">${botResponse}</div>`;
        } catch (error) {
            // Handle errors
            botThinking.innerHTML = `<div class="message-content">Error: ${error.message}</div>`;
        }

        // Scroll to bottom of chat window
        chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    // Function to add a message to the chat window
    function addMessage(sender, content) {
        const chatWindow = document.getElementById('chat-window');
        const message = document.createElement('div');
        message.className = `message ${sender}`;
        message.innerHTML = `<div class="message-content">${content}</div>`;
        chatWindow.appendChild(message);
        return message.querySelector('.message-content');
    }

    // Function to convert LaTeX table to HTML table
    function convertLaTeXTableToHTML(latexTable) {
        // Remove LaTeX array environment
        latexTable = latexTable.replace(/\\begin\{array\}(.*?)\\end\{array\}/s, '$1');

        // Split rows by \hline
        const rows = latexTable.split('\\hline').filter(row => row.trim() !== '');

        // Build HTML table
        let htmlTable = '<table>';
        rows.forEach(row => {
            htmlTable += '<tr>';
            // Split columns by &
            const columns = row.split('&').map(col => col.trim());
            columns.forEach(col => {
                htmlTable += `<td>${col}</td>`;
            });
            htmlTable += '</tr>';
        });
        htmlTable += '</table>';

        return htmlTable;
    }

    // Allow pressing "Enter" to send message
    document.getElementById('chat-input').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });
</script>

</body>
</html>
